<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>数据库优化第一步看懂explain</title>
      <link href="//post/arary/Explain.html"/>
      <url>//post/arary/Explain.html</url>
      
        <content type="html"><![CDATA[<h2 id="explain常用字段"><a href="#explain常用字段" class="headerlink" title="explain常用字段"></a>explain常用字段</h2><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><ul><li>type ：访问的类型</li><li>key ：实际使用到的索引，如果为NULL，则没有使用索引</li><li>ref ：显示索引的哪一列被使用了，如果可能的话，是一个常数，哪些列或常量被用于查找索引列上的值</li><li>rows ：根据表统计信息及索引选用情况，大致估算出找到所需的记录所需读取的行数</li><li>Extra ：包含不适合在其它列中显示但十分重要的额外信息</li></ul></blockquote><h2 id="表数据"><a href="#表数据" class="headerlink" title="表数据"></a>表数据</h2><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #F78C6C">CREATE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">TABLE</span><span style="color: #BABED8"> `</span><span style="color: #82AAFF">user</span><span style="color: #BABED8">` (</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> </span><span style="color: #C792EA">int</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">NOT NULL</span><span style="color: #BABED8"> AUTO_INCREMENT,</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">name</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> </span><span style="color: #C792EA">varchar</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">CHARACTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> armscii8 </span><span style="color: #C792EA">COLLATE</span><span style="color: #BABED8"> armscii8_general_ci </span><span style="color: #F78C6C">NOT NULL</span><span style="color: #BABED8">,</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">account</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> </span><span style="color: #C792EA">varchar</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">CHARACTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> armscii8 </span><span style="color: #C792EA">COLLATE</span><span style="color: #BABED8"> armscii8_general_ci </span><span style="color: #F78C6C">NOT NULL</span><span style="color: #BABED8">,</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">pass</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> </span><span style="color: #C792EA">varchar</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">CHARACTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> armscii8 </span><span style="color: #C792EA">COLLATE</span><span style="color: #BABED8"> armscii8_general_ci </span><span style="color: #F78C6C">NOT NULL</span><span style="color: #BABED8">,</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">email</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> </span><span style="color: #C792EA">varchar</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">CHARACTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> armscii8 </span><span style="color: #C792EA">COLLATE</span><span style="color: #BABED8"> armscii8_general_ci </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> </span><span style="color: #C792EA">DEFAULT</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">,</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #C792EA">PRIMARY KEY</span><span style="color: #BABED8"> (</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">USING</span><span style="color: #BABED8"> BTREE</span></span><span class="line"><span style="color: #BABED8">) ENGINE </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> InnoDB </span><span style="color: #F78C6C">CHARACTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> armscii8 </span><span style="color: #C792EA">COLLATE</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> armscii8_general_ci ROW_FORMAT </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">Dynamic</span><span style="color: #BABED8">;</span></span><span class="line"></span><span class="line"><span style="color: #F78C6C">INSERT INTO</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">test</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">.</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">user</span><span style="color: #89DDFF">`</span><span style="color: #BABED8"> (</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">name</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">account</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">pass</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">email</span><span style="color: #89DDFF">`</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">VALUES</span><span style="color: #BABED8"> (</span><span style="color: #F78C6C">1</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">User1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">pass1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user1@example.com</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">);</span></span><span class="line"><span style="color: #BABED8">。。。</span></span></code></pre></div><h2 id="常用分析"><a href="#常用分析" class="headerlink" title="常用分析"></a>常用分析</h2><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">EXPLAIN </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">*</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> id </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">14</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref   | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | const | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">4</span><span style="color: #BABED8">       | const |    </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">  |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>key: PRIMARY 走的主键索引</p><p>ref： const 判断条件为常数匹配</p><p>rows： 1  扫描数据条数</p></blockquote><p>范围匹配</p><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">EXPLAIN </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">*</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> id </span><span style="color: #89DDFF">&gt;=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">10</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">and</span><span style="color: #BABED8"> id </span><span style="color: #89DDFF">&lt;=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">50</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra       |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">range</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">4</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">41</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>key: PRIMARY 主键索引</p><p>type： range 区间扫描</p><p>rows: 41 扫描行数</p><p>Extra： Using where 使用了where条件</p></blockquote><p>唯一约束</p><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #676E95; font-style: italic">-- 将account字段设置为唯一约束</span></span><span class="line"><span style="color: #F78C6C">ALTER</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">TABLE</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">ADD</span><span style="color: #BABED8"> </span><span style="color: #C792EA">CONSTRAINT</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">UNIQUE</span><span style="color: #BABED8">(account);</span></span><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> EXPLAIN </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">*</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> account </span><span style="color: #F78C6C">like</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user%</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">；</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra                 |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">range</span><span style="color: #BABED8"> | account       | account | </span><span style="color: #F78C6C">257</span><span style="color: #BABED8">     | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">51</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">index</span><span style="color: #BABED8"> condition |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>key: account account字段索引</p><p>row: 51扫描行数</p><p>Extra： Using index condition 使用索引判断</p></blockquote><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> EXPLAIN </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">*</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> account </span><span style="color: #F78C6C">like</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">%user</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8"> | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">  | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra       |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | ALL  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">          | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">    | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">1051</span><span style="color: #BABED8"> |    </span><span style="color: #F78C6C">11</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">11</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>type: ALL 全表扫描 常见的索引失效</p></blockquote><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> EXPLAIN </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">*</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> id </span><span style="color: #89DDFF">&gt;=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">5</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">and</span><span style="color: #BABED8"> id </span><span style="color: #89DDFF">&lt;=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">10</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">order by</span><span style="color: #BABED8"> account;</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra                       |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">range</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">4</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> |    </span><span style="color: #F78C6C">6</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">where</span><span style="color: #BABED8">; </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> filesort |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-----------------------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>Extra: Using where; Using filesort 使用条件判断，将判断出的数据进行文件排序（通常是以为没走索引所以才需要排序）</p></blockquote><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> explain </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">count</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">group by</span><span style="color: #BABED8"> pass;</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8"> | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">  | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra           |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | ALL  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">          | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">    | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">1051</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> temporary |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> explain </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">count</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">group by</span><span style="color: #BABED8"> id;</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+-----------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys   | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra       |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+-----------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">index</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8">,account | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">4</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">1051</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">index</span><span style="color: #BABED8"> |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+-----------------+---------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>Extra : Using temporary 表示Mysql创建了临时表来查询存储结果，通用在排序或分组发生</p></blockquote><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> explain </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">count</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> id </span><span style="color: #F78C6C">in</span><span style="color: #BABED8">( </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">,</span><span style="color: #F78C6C">123</span><span style="color: #BABED8">,</span><span style="color: #F78C6C">112</span><span style="color: #BABED8">,</span><span style="color: #F78C6C">121</span><span style="color: #BABED8">);</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8">  | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">     | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra                    |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">range</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">PRIMARY</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">4</span><span style="color: #BABED8">       | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> |    </span><span style="color: #F78C6C">4</span><span style="color: #BABED8"> |   </span><span style="color: #F78C6C">100</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">where</span><span style="color: #BABED8">; </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">index</span><span style="color: #BABED8"> |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> explain </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">count</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">name</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8">( user1,user3,user20,user40);</span></span><span class="line"><span style="color: #BABED8">ERROR </span><span style="color: #F78C6C">1054</span><span style="color: #BABED8"> (42S22): Unknown column </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">where clause</span><span style="color: #89DDFF">&#39;</span></span><span class="line"><span style="color: #BABED8">mysql</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> explain </span><span style="color: #F78C6C">select</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">count</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">*</span><span style="color: #BABED8">) </span><span style="color: #F78C6C">from</span><span style="color: #BABED8"> user </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">name</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8">( </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user3</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user20</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">,</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user40</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">);</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">| id | select_type | </span><span style="color: #F78C6C">table</span><span style="color: #BABED8"> | partitions | </span><span style="color: #F78C6C">type</span><span style="color: #BABED8"> | possible_keys | </span><span style="color: #F78C6C">key</span><span style="color: #BABED8">  | key_len | ref  | </span><span style="color: #F78C6C">rows</span><span style="color: #BABED8"> | filtered | Extra       |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #BABED8">|  </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">SIMPLE</span><span style="color: #BABED8">      | user  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">       | ALL  | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">          | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8">    | </span><span style="color: #F78C6C">NULL</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">1051</span><span style="color: #BABED8"> |    </span><span style="color: #F78C6C">40</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> | </span><span style="color: #F78C6C">Using</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">where</span><span style="color: #BABED8"> |</span></span><span class="line"><span style="color: #89DDFF">+</span><span style="color: #676E95; font-style: italic">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><span class="line"><span style="color: #F78C6C">1</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">row</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">in</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">set</span><span style="color: #BABED8">, </span><span style="color: #F78C6C">1</span><span style="color: #BABED8"> warning (</span><span style="color: #F78C6C">0</span><span style="color: #BABED8">.</span><span style="color: #F78C6C">00</span><span style="color: #BABED8"> sec)</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>项目实战之批量插入性能分析</title>
      <link href="//post/backend/batchInsert.html"/>
      <url>//post/backend/batchInsert.html</url>
      
        <content type="html"><![CDATA[<blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>不是专业测试，时间的参考价值不大，但是常见的批量插入方法应该能帮到你。</p></blockquote><h2 id="模拟表"><a href="#模拟表" class="headerlink" title="模拟表"></a>模拟表</h2><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #F78C6C">DROP</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">TABLE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">IF</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">EXISTS</span><span style="color: #BABED8"> emp;</span></span><span class="line"><span style="color: #F78C6C">CREATE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">TABLE</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">emp</span><span style="color: #BABED8"> (</span></span><span class="line"><span style="color: #BABED8">    id </span><span style="color: #C792EA">INT</span><span style="color: #BABED8"> AUTO_INCREMENT </span><span style="color: #C792EA">PRIMARY KEY</span><span style="color: #BABED8">,</span></span><span class="line"><span style="color: #BABED8">    userName </span><span style="color: #C792EA">VARCHAR</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">),</span></span><span class="line"><span style="color: #BABED8">    pass </span><span style="color: #C792EA">VARCHAR</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">),</span></span><span class="line"><span style="color: #BABED8">    email </span><span style="color: #C792EA">VARCHAR</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">255</span><span style="color: #BABED8">)</span></span><span class="line"><span style="color: #BABED8">);</span></span><span class="line"></span></code></pre></div><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><div class="language-sql"><button title="Copy code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #BABED8">DELIMITER </span><span style="color: #89DDFF">//</span></span><span class="line"></span><span class="line"><span style="color: #F78C6C">CREATE</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">PROCEDURE</span><span style="color: #BABED8"> insert_emp_data</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #F78C6C">BEGIN</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">DECLARE</span><span style="color: #BABED8"> i </span><span style="color: #C792EA">INT</span><span style="color: #BABED8"> </span><span style="color: #C792EA">DEFAULT</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">DECLARE</span><span style="color: #BABED8"> batch_size </span><span style="color: #C792EA">INT</span><span style="color: #BABED8"> </span><span style="color: #C792EA">DEFAULT</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1000</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">DECLARE</span><span style="color: #BABED8"> total </span><span style="color: #C792EA">INT</span><span style="color: #BABED8"> </span><span style="color: #C792EA">DEFAULT</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">100000</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">DECLARE</span><span style="color: #BABED8"> j </span><span style="color: #C792EA">INT</span><span style="color: #BABED8">;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">WHILE</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">&lt;=</span><span style="color: #BABED8"> total DO</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #F78C6C">START TRANSACTION</span><span style="color: #BABED8">;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> j </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">0</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #F78C6C">WHILE</span><span style="color: #BABED8"> j </span><span style="color: #89DDFF">&lt;</span><span style="color: #BABED8"> batch_size </span><span style="color: #F78C6C">AND</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">&lt;=</span><span style="color: #BABED8"> total DO</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #F78C6C">INSERT INTO</span><span style="color: #BABED8"> emp (userName, pass, email)</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #F78C6C">VALUES</span><span style="color: #BABED8"> (</span><span style="color: #82AAFF">CONCAT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, i), </span><span style="color: #82AAFF">CONCAT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">pass</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, i), </span><span style="color: #82AAFF">CONCAT</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">user</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">, i, </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">@example.com</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">));</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">+</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #F78C6C">SET</span><span style="color: #BABED8"> j </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> j </span><span style="color: #89DDFF">+</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #F78C6C">END</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">WHILE</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #F78C6C">COMMIT</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #F78C6C">END</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">WHILE</span><span style="color: #BABED8">;</span></span><span class="line"><span style="color: #F78C6C">END</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">//</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">DELIMITER ;</span></span><span class="line"><span style="color: #F78C6C">CALL</span><span style="color: #BABED8"> insert_emp_data</span><span style="color: #89DDFF">()</span><span style="color: #BABED8">;</span></span></code></pre></div><p>使用Mysql自带的存储过程进行10万条数据插入： </p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>耗时： 9.125 s</p></blockquote><h2 id="Mybatis-Foreach"><a href="#Mybatis-Foreach" class="headerlink" title="Mybatis-Foreach"></a>Mybatis-Foreach</h2><p>组装数据</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">@</span><span style="color: #C792EA">RestController</span></span><span class="line"><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">class</span><span style="color: #BABED8"> </span><span style="color: #FFCB6B">TestController</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">private</span><span style="color: #BABED8"> </span><span style="color: #C792EA">static</span><span style="color: #BABED8"> </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8">  list</span><span style="color: #89DDFF">;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">@</span><span style="color: #C792EA">Resource</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">private</span><span style="color: #BABED8"> </span><span style="color: #C792EA">TestMapper</span><span style="color: #BABED8"> testMapper</span><span style="color: #89DDFF">;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">static</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        list </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #C792EA">ArrayList</span><span style="color: #89DDFF">&lt;&gt;(</span><span style="color: #F78C6C">100000</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF; font-style: italic">for</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #C792EA">int</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">;</span><span style="color: #BABED8"> i </span><span style="color: #89DDFF">&lt;</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">100000</span><span style="color: #89DDFF">;</span><span style="color: #BABED8"> i</span><span style="color: #89DDFF">++)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #C792EA">Emp</span><span style="color: #BABED8"> emp </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Emp</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">            emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setUserName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">user</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">+</span><span style="color: #BABED8">i</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">            emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setPass</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">123</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">+</span><span style="color: #BABED8">i</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">            emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setEmail</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">example</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">+</span><span style="color: #BABED8">i</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">            list</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">emp</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">@</span><span style="color: #C792EA">GetMapping</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">/foreach</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">InsertForeach</span><span style="color: #89DDFF">()&#123;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> list1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> TestController</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">list</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">        testMapper</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">testBatchInsert</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">list1</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span><span class="line"></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>失败，直接语法错误，看来values应该是有长度限制</p></blockquote><h2 id="分页处理"><a href="#分页处理" class="headerlink" title="分页处理"></a>分页处理</h2><p>将代码改装成分页处理</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">@</span><span style="color: #C792EA">GetMapping</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">/foreach</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">InsertForeach</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> throws InterruptedException </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> list1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> TestController</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">list</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">long</span><span style="color: #BABED8"> s </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;&gt;</span><span style="color: #BABED8"> partition </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Lists</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">partition</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">list1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">400</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">AtomicInteger</span><span style="color: #BABED8"> startRow </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">AtomicInteger</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF; font-style: italic">while</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(true)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        testMapper</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">testBatchInsert</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">partition</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">startRow</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">()));</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">Integer</span><span style="color: #BABED8"> offset </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> startRow</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">incrementAndGet</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">// 最后一页</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8">offset </span><span style="color: #89DDFF">==</span><span style="color: #BABED8"> partition</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">size</span><span style="color: #89DDFF">())</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #89DDFF; font-style: italic">break</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">-</span><span style="color: #BABED8"> s</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>耗时： 7.416</p></blockquote><h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">@</span><span style="color: #C792EA">GetMapping</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">/foreach</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">InsertForeach</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> throws InterruptedException </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> list1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> TestController</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">list</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">long</span><span style="color: #BABED8"> s </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;&gt;</span><span style="color: #BABED8"> partition </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Lists</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">partition</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">list1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">400</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">ThreadPoolExecutor</span><span style="color: #BABED8"> threadPool </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">ThreadPoolExecutor</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">20</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">50</span><span style="color: #89DDFF">,</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #F78C6C">4</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">ArrayBlockingQueue</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">200</span><span style="color: #89DDFF">),</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> ThreadPoolExecutor</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">AbortPolicy</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">CountDownLatch</span><span style="color: #BABED8"> countDownLatch </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">CountDownLatch</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">partition</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">size</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF; font-style: italic">for</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> item </span><span style="color: #89DDFF; font-style: italic">:</span><span style="color: #BABED8"> partition</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">            threadPool</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">execute</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Thread</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Runnable</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">@</span><span style="color: #C792EA">Override</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">run</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">                    testMapper</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">testBatchInsert</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">item</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #89DDFF">&#125;));</span></span><span class="line"><span style="color: #BABED8">            countDownLatch</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">countDown</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">        countDownLatch</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">await</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">        System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">-</span><span style="color: #BABED8"> s</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>耗时： 0.151 可能是测试方法不对</p></blockquote><h2 id="JdbcTemp"><a href="#JdbcTemp" class="headerlink" title="JdbcTemp"></a>JdbcTemp</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">@</span><span style="color: #C792EA">GetMapping</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">/foreach</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">InsertForeach</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> throws InterruptedException </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> list1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> TestController</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">list</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">long</span><span style="color: #BABED8"> s </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">String</span><span style="color: #BABED8"> sql </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">INSERT INTO emp (userName, pass, email) VALUES (?, ?, ?)</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    jdbcTemplate</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">batchUpdate</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">sql</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">BatchPreparedStatementSetter</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">@</span><span style="color: #C792EA">Override</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">setValues</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">PreparedStatement</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">ps</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #C792EA">int</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">i</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #C792EA">throws</span><span style="color: #BABED8"> </span><span style="color: #C792EA">SQLException</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #C792EA">Emp</span><span style="color: #BABED8"> emp </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> list1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">i</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">            ps</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setString</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getUserName</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #BABED8">            ps</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setString</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getPass</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #BABED8">            ps</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setString</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> emp</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getEmail</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">&#125;</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">@</span><span style="color: #C792EA">Override</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">int</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">getBatchSize</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">            </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #BABED8"> list1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">size</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;);</span></span><span class="line"><span style="color: #BABED8">    System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">-</span><span style="color: #BABED8"> s</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>耗时： 60.058 s </p></blockquote><h2 id="sqlsession"><a href="#sqlsession" class="headerlink" title="sqlsession"></a>sqlsession</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">@</span><span style="color: #C792EA">GetMapping</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">/foreach</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">InsertForeach</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> throws InterruptedException </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> list1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> TestController</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">list</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;&gt;</span><span style="color: #BABED8"> partition </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Lists</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">partition</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">list1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">400</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">long</span><span style="color: #BABED8"> s </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">SqlSession</span><span style="color: #BABED8"> sqlSession </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> sqlSessionFactory</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">openSession</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">ExecutorType</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">BATCH</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">TestMapper</span><span style="color: #BABED8"> sqlSessionMapper </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> sqlSession</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getMapper</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">TestMapper</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">class</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">long</span><span style="color: #BABED8"> start </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">();</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF; font-style: italic">for</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #C792EA">List</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">Emp</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> item </span><span style="color: #89DDFF; font-style: italic">:</span><span style="color: #BABED8"> partition</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        sqlSessionMapper</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">testBatchInsert</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">item</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #BABED8">    sqlSession</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">commit</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">    System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">currentTimeMillis</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">-</span><span style="color: #BABED8"> s</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>耗时： 6.544 s</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis实战之Redisson使用技巧详解</title>
      <link href="//post/backend/redisson.html"/>
      <url>//post/backend/redisson.html</url>
      
        <content type="html"><![CDATA[<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>什么是 Redisson？来自于官网上的描述内容如下！</p><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>Redisson 是一个在 Redis 的基础上实现的 Java 驻内存数据网格客户端（In-Memory Data Grid）。它不仅提供了一系列的 redis<br>常用数据结构命令服务，还提供了许多分布式服务，例如分布式锁、分布式对象、分布式集合、分布式远程服务、分布式调度任务服务等等。</p></blockquote><p>相比于 Jedis、Lettuce 等基于 redis 命令封装的客户端，Redisson 提供的功能更加高端和抽象，逼格高！</p><p>更多功能特性和开发文档说明，可用移步github进行获取，访问地址如下：</p><p><a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95">redisson地址</a></p><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a><strong>基本使用</strong></h2><p>跟过去一样，首先创建一个 maven 项目，添加<code>Redisson</code>依赖包。</p><div class="language-xml"><button title="Copy code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">dependency</span><span style="color: #89DDFF">&gt;</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">groupId</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8">org.redisson</span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">groupId</span><span style="color: #89DDFF">&gt;</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">artifactId</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8">redisson</span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">artifactId</span><span style="color: #89DDFF">&gt;</span></span><span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178">version</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8">3.13.6</span><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">version</span><span style="color: #89DDFF">&gt;</span></span><span class="line"><span style="color: #89DDFF">&lt;/</span><span style="color: #F07178">dependency</span><span style="color: #89DDFF">&gt;</span></span></code></pre></div><p>单机环境下，简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">public</span><span style="color: #BABED8"> </span><span style="color: #C792EA">static</span><span style="color: #BABED8"> </span><span style="color: #C792EA">void</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">main</span><span style="color: #89DDFF">(</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">[]</span><span style="color: #BABED8"> args</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">        config</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSingleServer</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setConnectionMinimumIdleSize</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">5</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">// 设置最下空闲数</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setConnectionPoolSize</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">10</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">// 设置连接池大小</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setIdleConnectionTimeout</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">*</span><span style="color: #F78C6C">1000</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">// 设置空闲连接超时时间 单位为毫秒</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setConnectTimeout</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">10</span><span style="color: #89DDFF">*</span><span style="color: #F78C6C">1000</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">// 设置连接超时时间 单位为毫秒</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">                </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setDatabase</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">//获取客户端</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redissonClient </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #C792EA">RBucket</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> selfBucket </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBucket</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">selfBucket</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        selfBucket</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">set</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">hello</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">        selfBucket</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">set</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">world</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">//获取所有的key</span></span><span class="line"><span style="color: #BABED8">        redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getKeys</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">getKeys</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">forEach</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">key </span><span style="color: #C792EA">-&gt;</span><span style="color: #BABED8"> System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">key</span><span style="color: #89DDFF">));</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">//关闭客户端</span></span><span class="line"><span style="color: #BABED8">        redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">shutdown</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span></code></pre></div><blockquote><span class="custom-blockquote-svg"><svg width="24" height="24" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg" data-reactroot=""><path fill="" d="M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z" undefined="1"></path><path fill="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z" undefined="1"></path><path fill="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z" undefined="1"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z"></path><path stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" stroke="" d="M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z"></path></svg></span><p>ps：创建 RedissonClient 对象实例的方式多钟多样，可以直接通过在代码中设置 Redis 服务的相关参数创建，也可以通过加载 JSON 格式、 YAML 格式或者 Spring XML 配置文件来创建，详细的参数配置可用移步上文提到的 Redisson 开发文档。</p></blockquote><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>Redisson 支持通过<code>RBucket</code>对象来操作字符串数据结构，通过<code>RBucket</code>实例可以设置<code>value</code>或设置<code>value</code>和有效期，简单样例如下！</p><ol><li>简单字符串操作</li></ol><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #676E95; font-style: italic">//字符串操作</span></span><span class="line"><span style="color: #C792EA">RBucket</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> rBucket </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBucket</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">strKey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 设置value和key的有效期</span></span><span class="line"><span style="color: #BABED8">rBucket</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">set</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">张三</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rBucket.getAndDelete();  获取strKey的值并删除strKey这个key</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rBucket.compareAndSet(&quot;张三&quot;,&quot;李四&quot;); 和cas想同先比较后设置</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rBucket.setIfExists(&quot;hello1&quot;); 存在值就设置</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 通过key获取value</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rBucket.isExists(); 判断当前桶是否有值</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rBucket.delete(); 删除桶中数据</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBucket</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">strKey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">());</span></span></code></pre></div><ol start="2"><li>对象操作</li></ol><p>Redisson 支持将对象作为<code>value</code>存入<code>redis</code>，被存储的对象事先必须要实现序列化接口<code>Serializable</code>，否则会报错，简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #676E95; font-style: italic">//字符串对象操作</span></span><span class="line"><span style="color: #C792EA">RBucket</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">user</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> rBucket </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBucket</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">strKey2</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rBucket</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">set</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">1001</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">stone</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBucket</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">strKey2</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">());</span></span></code></pre></div><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p>Redisson 支持通过<code>RMap</code>对象来操作哈希数据结构，简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">RMap</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">String</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #C792EA">String</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> rMap </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getMap</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mapkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rMap</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">put</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">id</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">123</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rMap</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">put</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">name</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">赵四</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rMap</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">put</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">age</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">50</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rMap.putIfAbsent() 如果不存在设置</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rMap.size() 大小</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rMap.clear();清空集合</span></span><span class="line"><span style="color: #BABED8">rMap</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getMap</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mapkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">name</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span></code></pre></div><h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">RList</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">user</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> rList </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getList</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">listkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">张三</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rList</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student1</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">李四</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rList</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student2</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #676E95; font-style: italic">//设置过期时间</span></span><span class="line"><span style="color: #BABED8">rList</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rList.subList(0,rList.size()).clear(); 获取子列表</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rList.contains(student1);  判断是否存在student1</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rList.indexOf(student2)   返回student2第一次出现的位置</span></span><span class="line"><span style="color: #676E95; font-style: italic">//  rList.lastIndexOf(student2)   返回student2最后一次出现的位置</span></span><span class="line"><span style="color: #676E95; font-style: italic">//rList.retainAll(Arrays.asList(student2)); 仅保留列表中存在的集合</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rList.toArray() 转化成集合</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 通过key获取value</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getList</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">listkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span></code></pre></div><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">RSet</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">user</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> rSet </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getSet</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">setkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">1L</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">张三</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rSet</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student1</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">2L</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">李四</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rSet</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student2</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">rSet</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rSet.contains(student1);判断集合中是否包含指定的元素。</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rSet.iterator();返回集合的迭代器</span></span><span class="line"><span style="color: #676E95; font-style: italic">// rSet.retainAll(Arrays.asList(student1, student2));仅保留集合中包含在指定集合中的元素，移除其他元素。</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getSet</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">setkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span></code></pre></div><h2 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h2><p>Redisson 支持通过<code>RSortedSet</code>对象来操作有序集合数据结构，在使用对象来存储之前，实体对象必须先实现<code>Comparable</code>接口，并重写比较逻辑，否则会报错，简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">RSortedSet</span><span style="color: #89DDFF">&lt;</span><span style="color: #C792EA">user</span><span style="color: #89DDFF">&gt;</span><span style="color: #BABED8"> sortSetkey </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">get</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">sortSetkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">张三</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">sortSetkey</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student1</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">user student2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">user</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setId</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">student2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">李四</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">sortSetkey</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">student2</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #676E95; font-style: italic">// sortSetkey.iterator() 返回集合的迭代器</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getSortedSet</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">sortSetkey</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span></code></pre></div><h2 id="添加监听"><a href="#添加监听" class="headerlink" title="添加监听"></a>添加监听</h2><p>以String为例来对redis的一些操作进行监听</p><h2 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h2><p>布隆过滤器（Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。</p><p>布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。</p><p>Redisson 支持通过<code>RBloomFilter</code>对象来操作布隆过滤器，简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">RBloomFilter</span><span style="color: #BABED8"> rBloomFilter </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getBloomFilter</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">seqId</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 初始化预期插入的数据量为10000和期望误差率为0.01</span></span><span class="line"><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">tryInit</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">10000</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">0.01</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 插入部分数据</span></span><span class="line"><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">100</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">200</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">300</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">//设置过期时间</span></span><span class="line"><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 判断是否存在</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">contains</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">300</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">contains</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">200</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">rBloomFilter</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">contains</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">999</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">));</span></span></code></pre></div><h2 id="分布式自增id"><a href="#分布式自增id" class="headerlink" title="分布式自增id"></a>分布式自增id</h2><p>ID 是数据的唯一标识，传统的做法是利用 UUID 和<a href="https://cloud.tencent.com/solution/database?from_column=20065&from=20065">数据库</a>的自增 ID。</p><p>但由于 UUID 是无序的，不能附带一些其他信息，因此实际作用有限。</p><p>随着业务的发展，数据量会越来越大，需要对数据进行分表，甚至分库。分表后每个表的数据会按自己的节奏来自增，这样会造成 ID 冲突，因此这时就需要一个单独的机制来负责生成唯一 ID，redis 原生支持生成全局唯一的 ID。</p><p>简单样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">final</span><span style="color: #BABED8"> </span><span style="color: #C792EA">String</span><span style="color: #BABED8"> lockKey </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">aaaa</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #676E95; font-style: italic">//通过redis的自增获取序号</span></span><span class="line"><span style="color: #C792EA">RAtomicLong</span><span style="color: #BABED8"> atomicLong </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getAtomicLong</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lockKey</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">//设置过期时间</span></span><span class="line"><span style="color: #BABED8">atomicLong</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">expire</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">30</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">// 获取值</span></span><span class="line"><span style="color: #BABED8">System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">atomicLong</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">incrementAndGet</span><span style="color: #89DDFF">());</span></span></code></pre></div><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p>Redisson 最大的亮点，也是使用最多的功能，就是提供了强大的<strong>分布式锁实现</strong>，特点是：使用简单、安全！</p><p>简单使用样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSingleServer</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setPassword</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">123456</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">        </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setDatabase</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redissonClient </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #676E95; font-style: italic">//获取锁对象实例</span></span><span class="line"><span style="color: #C792EA">final</span><span style="color: #BABED8"> </span><span style="color: #C792EA">String</span><span style="color: #BABED8"> lockKey </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">abc</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #C792EA">RLock</span><span style="color: #BABED8"> rLock </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getLock</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lockKey</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #89DDFF; font-style: italic">try</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//尝试5秒内获取锁，如果获取到了，最长60秒自动释放</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">boolean</span><span style="color: #BABED8"> res </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> rLock</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">tryLock</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">5L</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">60L</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8">res</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">//成功获得锁，在这里处理业务</span></span><span class="line"><span style="color: #BABED8">        System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">获取锁成功</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #89DDFF">&#125;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">catch</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #C792EA">Exception</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">e</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">获取锁失败，失败原因：</span><span style="color: #89DDFF">&quot;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">+</span><span style="color: #BABED8"> e</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getMessage</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #89DDFF">&#125;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">finally</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//无论如何, 最后都要解锁</span></span><span class="line"><span style="color: #BABED8">    rLock</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">unlock</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span><span class="line"></span><span class="line"><span style="color: #676E95; font-style: italic">//关闭客户端</span></span><span class="line"><span style="color: #BABED8">redissonClient</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">shutdown</span><span style="color: #89DDFF">();</span></span></code></pre></div><p>以上是单机环境下的分布式锁实现逻辑，如果是集群环境下，应该如何处理呢？</p><p>Redisson 提供<code>RedissonRedLock</code>操作类，也被称为<strong>红锁</strong>，实现原理简单的总结有以下几点：</p><ul><li>1.如果有多个 redis 集群的时候，当且仅当从大多数（N&#x2F;2+1，比如有3个 redis 节点，那么至少有2个节点）的 Redis 节点都取到锁，并且获取锁使用的总耗时小于锁失效时间时，锁才算获取成功</li><li>2.如果获取失败，客户端会在所有的 Redis 实例上进行解锁操作</li><li>3.集群环境下，redis <a href="https://cloud.tencent.com/act/pro/promotion-cvm?from_column=20065&from=20065">服务器</a>直接不存在任何复制或者其他隐含的分布式协调机制，否则会存在实效的可能</li></ul><p><code>RedissonRedLock</code>简单使用样例如下！</p><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSingleServer</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">setAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://192.168.3.111:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setPassword</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">a123456</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setDatabase</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redissonClient1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config1</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSingleServer</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">setAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://192.168.3.112:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setPassword</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">a123456</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setDatabase</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redissonClient2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config2</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config3 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config3</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSingleServer</span><span style="color: #89DDFF">().</span><span style="color: #82AAFF">setAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://192.168.3.113:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setPassword</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">a123456</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">).</span><span style="color: #82AAFF">setDatabase</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redissonClient3 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config3</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #676E95; font-style: italic">//获取多个 RLock 对象</span></span><span class="line"><span style="color: #C792EA">final</span><span style="color: #BABED8"> </span><span style="color: #C792EA">String</span><span style="color: #BABED8"> lockKey </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">abc</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">;</span></span><span class="line"><span style="color: #C792EA">RLock</span><span style="color: #BABED8"> lock1 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient1</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getLock</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lockKey</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RLock</span><span style="color: #BABED8"> lock2 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient2</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getLock</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lockKey</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #C792EA">RLock</span><span style="color: #BABED8"> lock3 </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redissonClient3</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getLock</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lockKey</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #676E95; font-style: italic">//根据多个 RLock 对象构建 RedissonRedLock （最核心的差别就在这里）</span></span><span class="line"><span style="color: #C792EA">RedissonRedLock</span><span style="color: #BABED8"> redLock </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">RedissonRedLock</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">lock1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> lock2</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> lock3</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #89DDFF; font-style: italic">try</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//尝试5秒内获取锁，如果获取到了，最长60秒自动释放</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #C792EA">boolean</span><span style="color: #BABED8"> res </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> redLock</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">tryLock</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">5L</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">60L</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> TimeUnit</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">SECONDS</span><span style="color: #89DDFF">);</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8">res</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">        </span><span style="color: #676E95; font-style: italic">//成功获得锁，在这里处理业务</span></span><span class="line"><span style="color: #BABED8">        System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">获取锁成功</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">&#125;</span></span><span class="line"><span style="color: #89DDFF">&#125;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">catch</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #C792EA">Exception</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">e</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #BABED8">    System</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">out</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">println</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">获取锁失败，失败原因：</span><span style="color: #89DDFF">&quot;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">+</span><span style="color: #BABED8"> e</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">getMessage</span><span style="color: #89DDFF">());</span></span><span class="line"><span style="color: #89DDFF">&#125;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">finally</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&#123;</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//无论如何, 最后都要解锁</span></span><span class="line"><span style="color: #BABED8">    redLock</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">unlock</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #89DDFF">&#125;</span></span></code></pre></div><h2 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useClusterServers</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setScanInterval</span><span style="color: #89DDFF">(</span><span style="color: #F78C6C">2000</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #676E95; font-style: italic">// 集群状态扫描间隔时间，单位是毫秒</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//可以用&quot;rediss://&quot;来启用SSL连接</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addNodeAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:7000</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:7001</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addNodeAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:7002</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redisson </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config</span><span style="color: #89DDFF">);</span></span></code></pre></div><h2 id="主从模式"><a href="#主从模式" class="headerlink" title="主从模式"></a>主从模式</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useMasterSlaveServers</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//可以用&quot;rediss://&quot;来启用SSL连接</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setMasterAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addSlaveAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6389</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6332</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6419</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addSlaveAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">redis://127.0.0.1:6399</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redisson </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config</span><span style="color: #89DDFF">);</span></span></code></pre></div><h2 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h2><div class="language-java"><button title="Copy code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" style="background-color: #1a1a1a" tabindex="0"><code><span class="line"><span style="color: #C792EA">Config</span><span style="color: #BABED8"> config </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF; font-style: italic">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Config</span><span style="color: #89DDFF">();</span></span><span class="line"><span style="color: #BABED8">config</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">useSentinelServers</span><span style="color: #89DDFF">()</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">setMasterName</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">mymaster</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #89DDFF">    </span><span style="color: #676E95; font-style: italic">//可以用&quot;rediss://&quot;来启用SSL连接</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addSentinelAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">127.0.0.1:26389</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">127.0.0.1:26379</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">)</span></span><span class="line"><span style="color: #BABED8">    </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">addSentinelAddress</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">&quot;</span><span style="color: #C3E88D">127.0.0.1:26319</span><span style="color: #89DDFF">&quot;</span><span style="color: #89DDFF">);</span></span><span class="line"></span><span class="line"><span style="color: #C792EA">RedissonClient</span><span style="color: #BABED8"> redisson </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> Redisson</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">create</span><span style="color: #89DDFF">(</span><span style="color: #BABED8">config</span><span style="color: #89DDFF">);</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
